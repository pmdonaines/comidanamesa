{% extends 'core/base.html' %}

{% block title %}Detalhes da Pessoa - Comida na Mesa{% endblock %}

{% block content %}
<div class="space-y-8">
  <!-- Header -->
  <div class="md:flex md:items-center md:justify-between">
    <div class="min-w-0 flex-1">
      <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
        {{ pessoa.nom_pessoa }}
      </h2>
      <p class="mt-2 text-sm text-gray-500">NIS: {{ pessoa.num_nis_pessoa_atual }}{% if pessoa.num_cpf_pessoa %} • CPF: {{ pessoa.num_cpf_pessoa }}{% endif %}</p>
      <p class="mt-1 text-sm text-gray-500">Família atual: <a href="{% url 'cecad_familia_detail' pessoa.familia.pk %}" class="text-emerald-700 hover:text-emerald-800">{{ pessoa.familia.cod_familiar_fam }}</a></p>
    </div>
    <div class="mt-4 flex gap-3 md:ml-4 md:mt-0">
      <a href="{% url 'cecad_pessoa_update' pessoa.familia.pk pessoa.pk %}"
         class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
        Editar
      </a>
      <a href="{% url 'cecad_pessoa_transfer_start' pessoa.familia.pk pessoa.pk %}"
         class="inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500">
        Transferir
      </a>
    </div>
  </div>

  <!-- Dados da Pessoa -->
  <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
    <div class="px-4 py-5 sm:p-6">
      <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Data de Nascimento</dt>
          <dd class="mt-1 text-sm text-gray-900">{{ pessoa.dat_nasc_pessoa|date:'d/m/Y'|default:'-' }}</dd>
        </div>
        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Parentesco com RF</dt>
          <dd class="mt-1 text-sm text-gray-900">{{ pessoa.get_cod_parentesco_rf_pessoa_display }}</dd>
        </div>
        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Sexo</dt>
          <dd class="mt-1 text-sm text-gray-900">{{ pessoa.get_cod_sexo_pessoa_display }}</dd>
        </div>
      </dl>
    </div>
  </div>

  <!-- Histórico de Transferências -->
  <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
    <div class="px-4 py-5 sm:p-6">
      <h3 class="text-base font-semibold leading-6 text-gray-900 mb-4">Histórico de Transferências</h3>
      {% if transferencias %}
      <div class="flow-root">
        <ul role="list" class="-my-5 divide-y divide-gray-200">
          {% for t in transferencias %}
          <li class="py-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-900">
                  <span class="font-medium">{{ t.transferido_em|date:'d/m/Y H:i' }}</span> —
                  {% if t.origem %} de <a href="{% url 'cecad_familia_detail' t.origem.pk %}" class="text-emerald-700 hover:text-emerald-800">{{ t.origem.cod_familiar_fam }}</a>{% else %} de -{% endif %}
                  para <a href="{% url 'cecad_familia_detail' t.destino.pk %}" class="text-emerald-700 hover:text-emerald-800">{{ t.destino.cod_familiar_fam }}</a>
                </p>
                <p class="text-xs text-gray-500">Por: {{ t.usuario.get_full_name|default:t.usuario.username|default:'Usuário removido' }}</p>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% else %}
      <p class="text-sm text-gray-500">Nenhuma transferência registrada.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
